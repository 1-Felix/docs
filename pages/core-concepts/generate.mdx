import { Callout, Tabs, Tab } from "nextra/components"
import { TutorialSchema } from "../../components/TutorialSchema"

# Generate data

<Callout emoji="🐥">
  This is a preview feature. We would love your [feedback](https://app.snaplet.dev/chat)!
</Callout>

## The need for generated data

Generated data, or seed data, is a useful tool in software development, providing an initial set of data for your database.

Here's why it's beneficial:

- **Development:** Provides a consistent dataset for developers.
- **Testing:** Ensures predictability when verifying features.
- **Demonstration:** Showcases your software's abilities with example content.
- **Default Data:** Adds necessary built-ins, like country lists.
- **Onboarding:** Gives new users a filled-out starting point.
- **Performance:** Helps simulate heavy usage scenarios.
- **Guides:** Common reference in tutorials.

While generated data might be the unsung hero of early development, it can get a bit needy as software evolves. But don't sweat it! Our mission is to save you from the never-ending saga of maintaining those seed scripts. Who has time for that, right?

## Introducing the Snaplet Data Client

The key to effortless generated data is a tool that deeply understands your database's schema. By introspecting your database, we are able to create a fully-typed client dedicated to data generation.

Right now, the Snaplet Data Client is tied to our configuration file, but we intend to generate a standalone version that you will be able to use anywhere!

Let's see how it works.

## Generating data with `snaplet generate`

### Prerequisites

- The [Snaplet CLI](/start-here/installation)

### Defining your first plan

We consider the following database schema used in a blog application:

<Tabs items={["diagram", "sql"]}>
<Tab>
<TutorialSchema className="nx-mx-auto nx-my-4" />
</Tab>
<Tab>
```sql
CREATE TABLE public."User" (
  id uuid NOT NULL PRIMARY KEY,
  username text NOT NULL,
  email text NOT NULL
);
CREATE TABLE public."Post" (
  id uuid NOT NULL PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  "createdBy" uuid NOT NULL REFERENCES public."User"(id)
);
CREATE TABLE public."Comment" (
  id uuid NOT NULL PRIMARY KEY,
  content text NOT NULL,
  "userId" uuid NOT NULL REFERENCES public."User"(id),
  "postId" uuid NOT NULL REFERENCES public."Post"(id),
  "writtenAt" timestamptz NOT NULL DEFAULT now()
);
```
</Tab>
</Tabs>

We now want to generate data based on these requirements:
- Creating a post with the title "Hello World!".
- The author of the post has an email that ends with "acme.org".
- This post receives 3 comments.

Let's see how to translate these requirements into a plan using the Snaplet Data Client.

<CH.Scrollycoding>

First, we need to define the `generate` key in our [`snaplet.config.ts`](/configuration/snaplet-config-file) file.

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {

  },
});
```

---

The `generate` key accepts a `plan` function in which an instance of the Snaplet Data Client is injected as `snaplet`.

```ts snaplet.config.ts focus=7:9
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {

    },
  },
});
```

---

The Snaplet Data Client exposes all your models as functions. These functions return a plan. You always start from a root model, here we start from the `Post` model.

```ts snaplet.config.ts focus=8:10
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({

      });
    },
  },
});
```

---

You use the `data` key to define the values of your model.

```ts snaplet.config.ts focus=9:11
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
        },
      });
    },
  },
});
```

---

You can also define the values of your model's relations. Here we define the author of the post represented by the `User` model.

```ts snaplet.config.ts focus=11:18
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
        },
      });
    },
  },
});
```

---

Finally, we also define the comments of the post represented by the `Comment` model. As we need more than one comment, we use the `count` key.

```ts snaplet.config.ts focus=19:21
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

---

Sounds like a plan!

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

</CH.Scrollycoding>

We drew significant inspiration from our friends at [Prisma](https://www.prisma.io/). If you're familiar with Prisma, using the Snaplet Data Client will feel incredibly intuitive and seamless.

### Executing the plan

At this point, you're ready to run your first `snaplet generate`!

Let's see what statements are generated by using the `--sql` option.

Run:

```bash >_&nbsp;terminal
snaplet generate --sql
```

Output:

```sql >_&nbsp;terminal
INSERT INTO public."User" (email, id, name) VALUES
-- This is the author of the post, notice the "acme.org" in the email
('Harold.Jast88421@acme.org', 'b8e07eae-5230-5193-a0ac-f2398d8a31e3', 'jampacked.mastoid32324'),
-- Those are the 3 users automatically generated to satisfy the 3 comments
('Narciso_Runolfsdottir15841@wallpaper-pine.info', '703e806b-1627-55c2-b24d-89fc7c38206f', 'boiling-measurement30380'),
('Finn.Douglas71373@tromp-midnight.biz', '01aa20af-4249-54af-b2fc-7aae61afe764', 'shoddy.throat26816'),
('Jaylon.Cartwright94743@infinitebillboard.net', '3a7b5218-ee17-5592-b13b-d8f54130dda7', 'perpetuate-pulley92958');

INSERT INTO public."Post" ("createdBy", content, id, title) VALUES
-- The post's title is correctly set to "There is a lot of snow around here!"
('b8e07eae-5230-5193-a0ac-f2398d8a31e3', 'Muva kakohymo va chimo sovikai rayukome havira, mimaviva soke vamikairae rae shimemuchi nivavimu ceasomeki mechi.', 'a492d66d-ca83-5bc0-a2eb-4f590e2797de', 'There is a lot of snow around here!');

INSERT INTO public."Comment" ("postId", "userId", content, id, "writtenAt") VALUES
-- The 3 comments are generated and linked automatically to the 3 users
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '703e806b-1627-55c2-b24d-89fc7c38206f', 'Yorae nomamea vamechima', '210a87ba-bafe-5e51-aa00-0fd5c6cfb76f', '2007-12-08T12:02:24.000Z'),
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '01aa20af-4249-54af-b2fc-7aae61afe764', 'Kekome kohachi', 'd7ee6e70-07ae-5ba7-9e6a-8c0d4d56ba05', '1981-06-26T17:45:37.000Z'),
('a492d66d-ca83-5bc0-a2eb-4f590e2797de', '3a7b5218-ee17-5592-b13b-d8f54130dda7', 'Kaishirae somema', 'f9a3f461-f31b-5e15-bcdb-2aa53622b635', '2002-07-03T06:42:44.000Z');
```