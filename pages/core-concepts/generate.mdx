import { Callout, Tabs, Tab } from "nextra/components"
import { TutorialSchema } from "../../components/TutorialSchema"

# Generate data

<Callout emoji="🐥">
  This is a preview feature. We would love your [feedback](https://app.snaplet.dev/chat)!
</Callout>

## The need for generated data

Generated data, or seed data, is a useful tool in software development, providing an initial set of data for your database.

Here's why it's beneficial:

- **Development:** Provides a consistent dataset for developers.
- **Testing:** Ensures predictability when verifying features.
- **Demonstration:** Showcases your software's abilities with example content.
- **Default Data:** Adds necessary built-ins, like country lists.
- **Onboarding:** Gives new users a filled-out starting point.
- **Performance:** Helps simulate heavy usage scenarios.
- **Guides:** Common reference in tutorials.

While generated data might be the unsung hero of early development, it can get a bit needy as software evolves. But don't sweat it! Our mission is to save you from the never-ending saga of maintaining those seed scripts. Who has time for that, right?

## Introducing the Snaplet Data Client

The key to effortless generated data is a tool that deeply understands your database's schema. By introspecting your database, we are able to create a fully-typed client dedicated to data generation.

Right now, the Snaplet Data Client is tied to our configuration file, but we intend to generate a standalone version that you will be able to use anywhere!

Let's see how it works.

## Generating data with `snaplet generate`

### Prerequisites

- The [Snaplet CLI](/start-here/installation)

### Defining your first plan

We consider the following database schema used in a blog application:

<Tabs items={["diagram", "sql"]}>
<Tab>
<TutorialSchema className="nx-mx-auto nx-my-4" />
</Tab>
<Tab>
```sql
CREATE TABLE public."User" (
  id uuid NOT NULL PRIMARY KEY,
  username text NOT NULL,
  email text NOT NULL
);
CREATE TABLE public."Post" (
  id uuid NOT NULL PRIMARY KEY,
  title text NOT NULL,
  content text NOT NULL,
  "createdBy" uuid NOT NULL REFERENCES public."User"(id)
);
CREATE TABLE public."Comment" (
  id uuid NOT NULL PRIMARY KEY,
  content text NOT NULL,
  "userId" uuid NOT NULL REFERENCES public."User"(id),
  "postId" uuid NOT NULL REFERENCES public."Post"(id),
  "writtenAt" timestamptz NOT NULL DEFAULT now()
);
```
</Tab>
</Tabs>

We now want to generate data based on these requirements:
- Creating a post with the title "Hello World!".
- The author of the post has an email that ends with "acme.org".
- This post receives 3 comments.

Let's see how to translate these requirements into a plan using the Snaplet Data Client.

<CH.Scrollycoding className="generate-tutorial-configuration-file">

First, we need to define the `generate` key in our [`snaplet.config.ts`](/configuration/snaplet-config-file) file.

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {

  },
});
```

---

The `generate` key accepts a `plan` function in which an instance of the Snaplet Data Client is injected as `snaplet`.

```ts snaplet.config.ts focus=7:9
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {

    },
  },
});
```

---

The Snaplet Data Client exposes all your models as functions. These functions return a plan. You always start from a root model, here we start from the `Post` model.

```ts snaplet.config.ts focus=8:10
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({

      });
    },
  },
});
```

---

You use the `data` key to define the values of your model.

```ts snaplet.config.ts focus=9:11
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
        },
      });
    },
  },
});
```

---

You can also define the values of your model's relations. Here we define the author of the post represented by the `User` model.

```ts snaplet.config.ts focus=11:18
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
        },
      });
    },
  },
});
```

---

Finally, we also define the comments of the post represented by the `Comment` model. As we need more than one comment, we use the `count` key.

```ts snaplet.config.ts focus=19:21
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

---

Sounds like a plan!

```ts snaplet.config.ts
/// <reference path=".snaplet/snaplet.d.ts" />
import { defineConfig } from 'snaplet';
import { copycat } from '@snaplet/copycat';

export default defineConfig({
  generate: {
    plan({ snaplet }) {
      return snaplet.Post({
        data: {
          title: 'Hello World!',
          User: {
            data: {
              email: ({ seed }) =>
                copycat.email(seed, {
                  domain: 'acme.org'
                }),
            },
          },
          Comment: {
            count: 3,
          },
        },
      });
    },
  },
});
```

</CH.Scrollycoding>

We drew significant inspiration from our friends at [Prisma](https://www.prisma.io/). If you're familiar with Prisma, using the Snaplet Data Client will feel incredibly intuitive and seamless.

### Executing the plan

At this point, you're ready to run your first `snaplet generate`!

Let's see what statements are generated by using the `--sql` option.

Run this command in your terminal:

```bash >_&nbsp;terminal
snaplet generate --sql
```

You should see the following output:

<CH.Slideshow className="generate-tutorial-sql-output">

Let's break it down.

```sql >_&nbsp;terminal
INSERT INTO public."User" (email,id,username) VALUES
('Craig.Bednar82365@acme.org', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', 'site-glance56860'),
('Humberto.Bruen34274@meternephew.org', '241ed1d9-c36c-50d4-b783-e12ce5187076', 'Alexis-Gleason29168'),
('Mattie.Braun26688@plodantechamber.com', '8c84c800-1b34-5843-b34b-73d3239f0c5b', 'blissful-fountain21234'),
('Dannie_Osinski74665@brownmidline.name', '0e041e68-00c0-53db-b0f8-e28be8a009e0', 'visualise-service97805');

INSERT INTO public."Post" (title,content,"createdBy",id) VALUES
('Hello World!', 'Ramo ramukin rae racea rakesoma, me vayota yume vi keyo munavima.', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf');

INSERT INTO public."Comment" (content,id,"postId","userId","writtenAt") VALUES
('Ma ceasova yuviketa shira chiyomu.', '13fdf8d2-2199-5dfd-81d0-c8dd3ce3b8a6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '241ed1d9-c36c-50d4-b783-e12ce5187076', DEFAULT),
('Mukinra kahyceako kiva kai me hameso rae.', '71a504eb-a859-5217-9e27-e15975ac69c6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '8c84c800-1b34-5843-b34b-73d3239f0c5b', DEFAULT),
('Ma nacea va memumi ta, mami viyua yoma shimusona viyo metake.', '8e826b31-f774-57f3-8ef2-183bddb35f3e', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '0e041e68-00c0-53db-b0f8-e28be8a009e0', DEFAULT);
```

---

This is the post, titled "Hello World!" as intended!

```sql >_&nbsp;terminal focus=8

```

---

This is the author of the post, notice the "acme.org" in the email.

```sql >_&nbsp;terminal focus=2

```

---

And here are the 3 comments.

```sql >_&nbsp;terminal focus=11:13

```

---

These 3 users were automatically generated to satisfy the 3 comments. You didn't need to define them, the Snaplet Data Client did it for you, because it knows your schema relationships it can fulfill them automatically.

```sql >_&nbsp;terminal focus=3:5

```

</CH.Slideshow>

It's now time to persist these data in your target database.

In order to do that, run this command in your terminal:

```bash >_&nbsp;terminal
snaplet generate
```

All done, it's time to code against your generated data!