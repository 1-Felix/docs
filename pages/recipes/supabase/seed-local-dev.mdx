import { Callout } from "nextra/components";

# Seeding a supabase local development stack.

Supabase makes it easy to set up a [local environment](https://supabase.com/docs/guides/cli/local-development) linked to your Supabase project. Snaplet can extend this functionality by helping you seed your local database. This ensures that you have readily available data to work with initially and for any future feature or testing needs.

In this short guide, we will use the [nextjs + supabase template](https://vercel.com/templates/next.js/supabase), to demonstrate how one could use the `snaplet generate` command to seed their local supabase stack.

## Prerequisites

- Supabase account
- [Supabase CLI installed](https://supabase.com/docs/guides/cli/getting-started)
- [Snaplet CLI installed](https://docs.snaplet.dev/getting-started/start-here#getting-started-with-snaplet-cli)

## 1. Create a Supabase project

Create a new project in the Supabase Dashboard by visiting https://supabase.com/

![Creating a supabase project](/recipes/supabase/supabase_new_project.webp)

## 2. Clone the nextjs + supabase template

2.1. Create a Next.js app using the supabase starter template by running the `npx` command:

```bash
npx create-next-app -e with-supabase
```

**2.2.** Use `cd` to change into the newly created directory:

```bash
cd name-of-new-app
```

## 3. Apply your migrations to the Supabase project.

**3.1.** Link your nextjs starter template to your supabase project

```bash
supabase init
```

**3.2.** Apply the migrations in `/supabase/migrations` to your project

> Your target database must have a structure, for the snaplet generate command to work.

```bash
supabase db push
```

**3.3.** Start your supabase local stack

```bash
supabase start
```

This command will print out your the following:

```bash
Started supabase local development setup.

         API URL: http://localhost:54321
          DB URL: postgresql://postgres:postgres@localhost:54322/postgres
      Studio URL: http://localhost:54323
    Inbucket URL: http://localhost:54324
        anon key: eyJh......
service_role key: eyJh......
```

**3.4.** Copy the **DB URL** we will use this in the next step (step 4) as your target database credentials.

## 4. Set up your generate config

**4.1.** Create a `snaplet.config.ts` file in the root of your project.

```bash
# select "yes" to create your `.snaplet/config.json`
# input the DB URL copied from the previous step for your target database
snaplet config setup
```

> The target database credentials will be used to introspect your database and generate a base config.

**4.2.** In the `snaplet.config.ts` update your generate field in your config, creating 20 todo items.

```ts
generate: {
    plan({ snaplet }) {
        // create 20 todos
        return snaplet.todos({
            count: 20,
        });
    },
},
```

Once you have gone through all the steps, you are now ready to seed your database.

## 5. Reset and seed your local development database

**5.1.** Run the `snaplet generate` to populate the project seed script in the `supabase/seed.sql` file.

```bash
snaplet generate --sql > supabase/seed.sql
```

**5.2** Reset your local development database, this will run all the existing migrations and applu the seed script.

```bash
supabase db reset
```

**5.3** Check your local database to see if the seed script was applied.

Now if you visit the local studio URL (http://localhost:54323) and inspect the **"todo"** table, you should see 20 todo items.

![20 todos in the studio dashboard](/recipes/supabase/20_todos.webp)

In your project if you move the `app/_examples/client-component/page.tsx` to `app/todos/page.tsx` and then visit http://localhost:3000/todos you should see the following:

![list of todos in nextjs app](/recipes/supabase/nextjs_todos.webp)

## All done!

You have now successfully seeded your local supabase development stack. You can now use the `snaplet generate` command to seed your local database with any data you need.

If you have any questions or feedback, please feel free to reach out to us on [Discord](https://app.snaplet.dev/chat).